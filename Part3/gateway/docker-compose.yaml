version: "3.8"

services:
  mosquitto:
    image: eclipse-mosquitto:2
    container_name: mosquitto
    ports:
      - "1883:1883"
    volumes:
      - ./mosquitto.conf:/mosquitto/config/mosquitto.conf:ro
    networks: [edgex-net]

  core-metadata:
    image: edgexfoundry/core-metadata:3.1
    container_name: edgex-core-metadata
    ports: ["59881:59881"]
    networks: [edgex-net]
    environment:
      EDGEX_SECURITY_SECRET_STORE: "false"

  core-data:
    image: edgexfoundry/core-data:3.1
    container_name: edgex-core-data
    ports: ["59880:59880"]
    networks: [edgex-net]
    environment:
      EDGEX_SECURITY_SECRET_STORE: "false"

  core-command:
    image: edgexfoundry/core-command:3.1
    container_name: edgex-core-command
    ports: ["59882:59882"]
    networks: [edgex-net]
    environment:
      EDGEX_SECURITY_SECRET_STORE: "false"

  device-mqtt:
    image: edgexfoundry/device-mqtt:3.1
    container_name: edgex-device-mqtt
    ports: ["59982:59982"]
    networks: [edgex-net]
    depends_on:
      - mosquitto
      - core-metadata
      - core-data
      - core-command
    environment:
      EDGEX_SECURITY_SECRET_STORE: "false"
      # Important: on force device-mqtt Ã  viser mosquitto du compose
      MQTT_BROKER: "tcp://mosquitto:1883"

  ui:
    image: edgexfoundry/edgex-ui:3.1
    container_name: edgex-ui
    ports: ["4000:4000"]
    networks: [edgex-net]
    depends_on:
      - core-metadata
      - core-data
      - core-command
    environment:
      EDGEX_SECURITY_SECRET_STORE: "false"

networks:
  edgex-net:
    driver: bridge
